/*! responsiveCarousel.JS - v1.2.0
 * http://basilio.github.com/responsiveCarousel
 *
 * Copyright (c) 2013 Basilio Cï¿½ceres <basilio.caceres@gmail.com>;
 * Licensed under the MIT license
 *
 * Update by TSL
 * 1. Stop, Resume button added to the Carousel control
 * 2. .delegate() replaced by .on() since deprecated >jQuery 1.7
 * 3. $.fn.carousel replaced by $.fn.respCarousel to avoid possible conflicts
 * 4. added `aria-hidden` control
 */
!function(i){"use strict";i.fn.respCarousel=function(t){var e,a;return e={infinite:!0,visible:1,speed:"fast",overflow:!1,autoRotate:!1,navigation:i(this).data("navigation"),itemMinWidth:0,itemEqualHeight:!1,itemMargin:0,itemClassActive:"crsl-active",imageWideClass:"wide-image",carousel:!0},i(this).each(function(){a=i(this),i.isEmptyObject(t)===!1&&i.extend(e,t),i.isEmptyObject(i(a).data("crsl"))===!1&&i.extend(e,i(a).data("crsl")),e.isTouch="ontouchstart"in document.documentElement||navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i)?!0:!1,a.init=function(){e.total=i(a).find(".crsl-item").length,e.itemWidth=i(a).outerWidth(),e.visibleDefault=e.visible,e.swipeDistance=null,e.swipeMinDistance=100,e.startCoords={},e.endCoords={},i(a).css({width:"100%"}),i(a).find(".crsl-item").css({position:"relative","float":"left",overflow:"hidden",height:"auto"}),i(a).find("."+e.imageWideClass).each(function(){i(this).css({display:"block",width:"100%",height:"auto"})}),i(a).find(".crsl-item iframe").attr({width:"100%"}),e.carousel&&i(a).find(".crsl-item:first-child").addClass(e.itemClassActive),i(a).find(".crsl-item:lt("+e.visible+")").attr("aria-hidden","false"),e.carousel&&e.infinite&&e.visible<e.total&&i(a).find(".crsl-item:first-child").before(i(".crsl-item:last-child",a)),e.overflow===!1?i(a).css({overflow:"hidden"}):i("html, body").css({"overflow-x":"hidden"}),i(a).trigger("initCarousel",[e,a]),a.testPreload(),a.config(),a.initRotate(),a.triggerNavs()},a.testPreload=function(){if(i(a).find("img").length>0){var t=i(a).find("img").length,n=1;i(a).find("img").each(function(){a.preloadImage(this,n,t),n++})}else i(a).trigger("loadedCarousel",[e,a])},a.preloadImage=function(t,n,r){var s=new Image,o={};o.src=void 0!==i(t).attr("src")?t.src:"",o.alt=void 0!==i(t).attr("alt")?t.alt:"",i(s).attr(o),i(s).on("load",function(){1===n&&i(a).trigger("loadingImagesCarousel",[e,a]),n===r&&i(a).trigger("loadedImagesCarousel",[e,a])})},a.config=function(){e.itemWidth=Math.floor((i(a).outerWidth()-e.itemMargin*(e.visibleDefault-1))/e.visibleDefault),e.itemWidth<=e.itemMinWidth?(e.visible=1===Math.floor((i(a).outerWidth()-e.itemMargin*(e.visible-1))/e.itemMinWidth)?Math.floor(i(a).outerWidth()/e.itemMinWidth):Math.floor((i(a).outerWidth()-e.itemMargin)/e.itemMinWidth),e.visible=e.visible<1?1:e.visible,e.itemWidth=1===e.visible?Math.floor(i(a).outerWidth()):Math.floor((i(a).outerWidth()-e.itemMargin*(e.visible-1))/e.visible)):e.visible=e.visibleDefault,e.carousel?(a.wrapWidth=Math.floor((e.itemWidth+e.itemMargin)*e.total),a.wrapMargin=a.wrapMarginDefault=e.infinite&&e.visible<e.total?parseInt(-1*(e.itemWidth+e.itemMargin),10):0,e.infinite&&e.visible<e.total&&0===i(a).find(".crsl-item."+e.itemClassActive).index()&&(i(a).find(".crsl-item:first-child").before(i(".crsl-item:last-child",a)),a.wrapMargin=a.wrapMarginDefault=parseInt(-1*(e.itemWidth+e.itemMargin),10)),i(a).find(".crsl-wrap").css({width:a.wrapWidth+"px",marginLeft:a.wrapMargin})):(a.wrapWidth=i(a).outerWidth(),i(a).find(".crsl-wrap").css({width:a.wrapWidth+e.itemMargin+"px"}),i("#"+e.navigation).hide()),i(a).find(".crsl-item").css({width:e.itemWidth+"px",marginRight:e.itemMargin+"px"}),a.equalHeights(),e.carousel&&(e.visible>=e.total?(e.autoRotate=!1,i("#"+e.navigation).hide()):i("#"+e.navigation).show())},a.equalHeights=function(){if(e.itemEqualHeight!==!1){var t=0;i(a).find(".crsl-item").each(function(){i(this).css({height:"auto"}),i(this).outerHeight()>t&&(t=i(this).outerHeight())}),i(a).find(".crsl-item").css({height:t+"px"})}return!0},a.initRotate=function(){e.autoRotate!==!1&&(a.rotateTime=window.setInterval(function(){a.rotate()},e.autoRotate))},a.triggerNavs=function(){var t=i("#"+e.navigation);t.on("click","a",function(e){e.preventDefault(),a.prepareExecute();var n=i(this);n.hasClass("previous")&&a.testPrevious(a.itemActive)?(a.previous(),t.removeClass("playing")):n.hasClass("next")&&a.testNext()?(a.next(),t.removeClass("playing")):n.hasClass("pause")?t.removeClass("playing"):n.hasClass("resume")&&(a.rotate(),a.initRotate(),t.addClass("playing"))})},a.prepareExecute=function(){return e.autoRotate&&clearInterval(a.rotateTime),a.preventAnimateEvent(),a.itemActive=i(a).find(".crsl-item."+e.itemClassActive),!0},a.preventAnimateEvent=function(){return i(a).find(".crsl-wrap:animated").length>0?!1:void 0},a.rotate=function(){return a.preventAnimateEvent(),a.itemActive=i(a).find(".crsl-item."+e.itemClassActive),a.next(),!0},a.testPrevious=function(t){return i(".crsl-wrap",a).find(".crsl-item").index(t)>0},a.testNext=function(){return!e.infinite&&a.wrapWidth>=(e.itemWidth+e.itemMargin)*(e.visible+1)-a.wrapMargin||e.infinite},a.previous=function(){a.wrapMargin=e.infinite?a.wrapMarginDefault+i(a.itemActive).outerWidth(!0):a.wrapMargin+i(a.itemActive).outerWidth(!0);var t=i(a.itemActive).prev(".crsl-item"),n="previous";i(a).trigger("beginCarousel",[e,a,n]),i(a).find(".crsl-wrap").animate({marginLeft:a.wrapMargin+"px"},e.speed,function(){i(a.itemActive).removeClass(e.itemClassActive),i(t).addClass(e.itemClassActive),e.infinite?i(this).css({marginLeft:a.wrapMarginDefault}).find(".crsl-item:first-child").before(i(".crsl-item:last-child",a)):(a.testPrevious(t)===!1&&i("#"+e.navigation).find(".previous").addClass("previous-inactive"),a.testNext()&&i("#"+e.navigation).find(".next").removeClass("next-inactive")),i(a).find(".crsl-item").each(function(t,a){var n=t>0&&t<=e.visible;i(a).attr("aria-hidden",!n)}),i(this).trigger("endCarousel",[e,a,n])})},a.next=function(){a.wrapMargin=e.infinite?a.wrapMarginDefault-i(a.itemActive).outerWidth(!0):a.wrapMargin-i(a.itemActive).outerWidth(!0);var t=i(a.itemActive).next(".crsl-item"),n="next";i(a).trigger("beginCarousel",[e,a,n]),i(a).find(".crsl-wrap").animate({marginLeft:a.wrapMargin+"px"},e.speed,function(){i(a.itemActive).removeClass(e.itemClassActive).attr("aria-hidden","true"),i(t).addClass(e.itemClassActive).attr("aria-hidden","false"),e.infinite?i(this).css({marginLeft:a.wrapMarginDefault}).find(".crsl-item:last-child").after(i(".crsl-item:first-child",a)):(a.testPrevious(t)&&i("#"+e.navigation).find(".previous").removeClass("previous-inactive"),a.testNext()===!1&&i("#"+e.navigation).find(".next").addClass("next-inactive")),i(a).find(".crsl-item").each(function(t,a){var n=t>0&&t<=e.visible;i(a).attr("aria-hidden",!n)}),i(this).trigger("endCarousel",[e,a,n])})};var n,r=!1;i(window).on("mouseleave",function(t){return t.target?n=t.target:t.srcElement&&(n=t.srcElement),r=i(a).attr("id")&&i(n).parents(".crsl-items").attr("id")===i(a).attr("id")||i(n).parents(".crsl-items").data("navigation")===i(a).data("navigation")?!0:!1,!1}),i(window).on("keydown",function(i){r===!0&&(37===i.keyCode?(a.prepareExecute(),a.previous()):39===i.keyCode&&(a.prepareExecute(),a.next()))}),e.isTouch&&i(a).on("touchstart",function(t){i(a).addClass("touching"),e.startCoords.pageX=e.endCoords.pageX=t.originalEvent.targetTouches[0].pageX,e.startCoords.pageY=e.endCoords.pageY=t.originalEvent.targetTouches[0].pageY,i(".touching").on("touchmove",function(i){e.endCoords.pageX=i.originalEvent.targetTouches[0].pageX,e.endCoords.pageY=i.originalEvent.targetTouches[0].pageY,Math.abs(parseInt(e.endCoords.pageX-e.startCoords.pageX,10))>Math.abs(parseInt(e.endCoords.pageY-e.startCoords.pageY,10))&&(i.preventDefault(),i.stopPropagation())})}).on("touchend",function(t){e.swipeDistance=e.endCoords.pageX-e.startCoords.pageX,e.swipeDistance>=e.swipeMinDistance?(a.prepareExecute(),a.previous(),t.preventDefault(),t.stopPropagation()):e.swipeDistance<=-e.swipeMinDistance&&(a.prepareExecute(),a.next(),t.preventDefault(),t.stopPropagation()),i(".touching").off("touchmove").removeClass("touching")}),i(a).on("loadedCarousel loadedImagesCarousel",function(){a.equalHeights()}),i(window).on("carouselResizeEnd",function(){e.itemWidth!==i(a).outerWidth()&&a.config()}),i(window).ready(function(){i(a).trigger("prepareCarousel",[e,a]),a.init(),i(window).on("resize",function(){this.carouselResizeTo&&clearTimeout(this.carouselResizeTo),this.carouselResizeTo=setTimeout(function(){i(this).trigger("carouselResizeEnd")},10)})}),i(document).ready(function(){a.testPreload(),a.config()})})}}(jQuery);